---
title: "GLM Assignment"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}
library(tidyverse) #importing, tidying, plotting data
library(knitr) #making tables
library(leaflet)
library(tinytex) #may need for knitting pdf versions of .rmd file
library(ggplot2)
library(data.table)
library(ggfortify)
```

#Body condition factor is BCF = ((body weight(g) - gut content(g)) / length(cm)^3) *100.

```{r Site_BCF}
library(readr)
Site_BCF <- read_csv("data/Site_BCF.csv")
```
```{r Binomial}
ggplot(Site_BCF,aes(Body_Condition_Factor,Site)) +
  geom_point() +
  geom_smooth(method="glm", method.args=list(family="binomial"(link="logit")))+
  geom_hline(yintercept = mean(Site_BCF$Site), linetype = "dashed") +
  labs(title="GLM, binomial count (DF/WB)")
```
```{r Binomial_m1}
fit.1 <- glm(Site_Location~Body_Condition_Factor, data=Site_BCF, binomial(link="logit"))
```


```{r Data}
library(readr)
Site_BodyConditionFactor <- read_csv("data/Site_BodyConditionFactor.csv")
```

# Binary Data
```{r Scatter}
ggplot(Site_BodyConditionFactor,aes(Body_Condition_Factor,Site_Location)) +
  geom_point() +
  geom_smooth() +
  xlab ("Body Condition Factor") +
  ylab ("Site") +
  labs(title="Raw Fit: 1=Wall Branch, 0=Dry Fork")
```



# Before we fit the GLM we can avoid inconveniently small coefficient values by rescaling distance in hundreds of meters.

```{r Tranformed Data}
Site_BodyConditionFactor$BCF100 <- Site_BodyConditionFactor$Body_Condition_Factor/100

```

```{r fit.1}
fit.1 <- glm(Site_Location~BCF100, data=Site_BodyConditionFactor, binomial(link="logit"))
```


```{r autplotfit.1}
autoplot(fit.1)
```

```{r binnedplot}
library(arm)
x <- predict(fit.1)
y <- resid(fit.1)
binnedplot(x, y)
```

```{r coeff}
coef(fit.1)
```

```{r coefint}
confint(fit.1)
```

```{r Binary_Data_Site_BCF}
ggplot(Site_BodyConditionFactor, aes(Body_Condition_Factor,Site_Location)) +
  geom_point() +
  geom_smooth(method="glm", method.args=list(family="binomial"(link="logit"))) + 
  xlab ("Body Condition Factor") +
  ylab ("Site") +
  labs (title="Raw Fit: 1=Wall Branch, 0=Dry Fork")
```

```{r Reverse}
invlogit <- function(x) {1 / ( 1+exp(-x) ) } 
invlogit(coef(fit.1)) 
```

```{r ReverseLogitSummary}
summary(fit.1)
```
```{r cofint_invLogit}
confint(fit.1)
```
#The Binary Data of the two sites (Wall Branch and Dry Fork) shows a negative #effect of Body Condition Factor


![Figure 1. Length Measurements](images/SRBD.jpeg)



![Figure 2. Fathead Minnow Gonads (Testes)](images/gonads.jpg)


```{r import GSI_Area}
library(readr)
GSI_RedColorationArea <- read_csv("data/GSI_RedColorationArea.csv")
```


```{r scatter plot GSI_RedColorationArea}
ggplot(data = GSI_RedColorationArea, aes(x=GSI_Value, y=Red_Coloration_Area)) +
geom_point()+
  xlab("GSI") +
	ylab("Red Coloration %") +
theme_bw()+
geom_smooth(method=lm)
ggsave("outputs/ScatterGSI_Area.png")
```


```{r Fit lm GSI_Area}

FitGSI_Area <- lm(data= GSI_RedColorationArea, Red_Coloration_Area~GSI_Value)


```

```{r autoplotlm}
autoplot(FitGSI_Area)
```

```{r Anova}
anova(FitGSI_Area)
summary(FitGSI_Area)
```

```{r boxcox}
boxcox(FitGSI_Area)
# #see linear regression for FitGSI_Area
```
#The R output for the boxcox() function plots the maximum likelihood surface (the curve) together with a maximum likelihood-based 95% CI (Hector, 2015)


#Helpful GLM component info from Hector, 2015 Ch8 

#GLMs have three components:
# 1.) a linear predictor- is what comes after the tilde (~) in our linear model formula
# 2.) a variance function - models the variation in the data;make use of a much wider rangefamily of distributions including the poisson, the binomial, and the gamma. 
#3.) a link function- plays a role equivalent to the transformation in normal least squares models. However, rather than transforming the data we transform the predictions made by the linear predictor. Commonly used link functions include the log, square root, and logistic.

```{r GLM default gaussian link}
GLMGSI_Area <- glm(Red_Coloration_Area~GSI_Value, data= GSI_RedColorationArea, family= gaussian(link=)) 
```

```{r Plotting GLM Gaussian}
ggplot(GSI_RedColorationArea,aes(GSI_Value,Red_Coloration_Area)) +
  geom_point() +
  geom_smooth(method="glm",colour="red",
                       method.args=list(family="gaussian"(link=)))+
  labs(title="GLM, Gaussian")

```

```{r GLM autoplot}
autoplot(GLMGSI_Area)
```

```{r ANOVA}
anova(GLMGSI_Area)
```
```{r summary default guassian link}
summary(GLMGSI_Area)
```
#log data with Gaussian


```{r gaussian_log}
gaussianlog <- glm(Red_Coloration_Area~GSI_Value, data= GSI_RedColorationArea, family= gaussian(link=log)) 
```

```{r Plotting Gaussian Log}
ggplot(GSI_RedColorationArea,aes(GSI_Value,Red_Coloration_Area)) +
  geom_point() +
  geom_smooth(method="glm",colour="red",
                       method.args=list(family="gaussian"(link=log)))+
  labs(title="GLM Log, Gaussian")

```


```{r anova Gaussian_Log}
anova(gaussianlog)
```

```{r summary gaussian log}
summary(gaussianlog)
```
# Family: Gamma

```{r Gamma}
gamma <- glm(Red_Coloration_Area~GSI_Value, data= GSI_RedColorationArea, family=Gamma(link= )) 
```

```{r Plotting_Gamma}
ggplot(GSI_RedColorationArea,aes(GSI_Value,Red_Coloration_Area)) +
  geom_point() +
  geom_smooth(method="glm",colour="red",
                       method.args=list(family="Gamma"(link=)))+
  labs(title="GLM, Gamma Variance")

```

```{r anova_gamma}
anova(gamma)
```

```{r Summary_Gamma}
summary(gamma)

```

```{r Gamma_sqrt}
gamma_sqrt <- glm(Red_Coloration_Area~GSI_Value, data= GSI_RedColorationArea, family=Gamma(link= "sqrt"))

```


```{r Plotting Gamma_sqrt}
ggplot(GSI_RedColorationArea,aes(GSI_Value,Red_Coloration_Area)) +
  geom_point() +
  geom_smooth(method="glm",colour="red",
                       method.args=list(family="Gamma"(link="sqrt")))+
  labs(title="GLM, square-root link, Gamma variance")

```

```{r summary of link_sqrt}
summary(gamma_sqrt)

```

```{r coef_Gammasqrt}
coef(gamma_sqrt)
```

```{r confint_Gammasqrt}
confint(gamma_sqrt)
```
```{r Gamma_log}
gammalog <- glm(Red_Coloration_Area~GSI_Value, data= GSI_RedColorationArea, family=Gamma(link= "log"))
```

```{r Plotting Gamma_log}
ggplot(GSI_RedColorationArea,aes(GSI_Value,Red_Coloration_Area)) +
  geom_point() +
  geom_smooth(method="glm",colour="red",
                       method.args=list(family="Gamma"(link="log")))+
  labs(title="GLM, log link, Gamma variance")

```



```{r Anova log}
anova(gammalog)
```

```{r summary of link_log}
summary(gammalog)

```

```{r coef_Gammalog}
coef(gammalog)
```
# tells you for every one unit increase in GSI, there is 2.65 increase in Coloration Area %


```{r confint_Gammalog}
confint(gammalog)
```



```{r SRBD Site Map}
leaflet() %>%
  setView(-86.854396, 36.26361 , zoom = 16) %>% #lat-long of the place of interest
  addTiles() %>%
  addProviderTiles('Esri.WorldImagery') %>%
  addMarkers(-86.854396, 36.26361 , popup = "Dry Fork, Whites Creek System")
```



```{r SRBD Site Map2}
leaflet() %>%
  setView(-87.287965, 36.499277 , zoom = 16) %>% #lat-long of the place of interest
  addTiles() %>%
  addProviderTiles('Esri.WorldImagery') %>%
  addMarkers(-87.287965, 36.499277 , popup = "Rotary Park, Wall Branch Creek System")
```


![Figure 3. Southern Redbelly Dace in Full Breeding Coloration (*Chrosomus erythrogaster*)](images/SouthernRedbellyDace.png)



